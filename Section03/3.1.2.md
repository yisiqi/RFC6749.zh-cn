### 3.1.2 重定向端点

在完成与资源所有者的交互后，授权服务器引导资源所有者的用户代理返回到客户端。授权服务器重定向用户代理至客户端的重定向端点，该端点是事先在客户端注册过程中或者当发起授权请求时与授权服务器建立的。

重定向端点URI必须是如[RFC3986的3.4节][RFC3986#3.4]所述的绝对URI。端点URI可以包含`application/x-www-form-urlencoded`格式（按[附录B](../AppendixB/b.md)）的查询部分（[RFC3986的3.4节][RFC3986#3.4]），当添加额外的查询参数时必须保留该部分。端点URI不得包含片段部分。


[RFC3986#3.4]: http://tools.ietf.org/html/rfc3986#section-3.4 "Uniform Resource Identifier (URI): Generic Syntax 3.4节"

#### 3.1.2.1 端点请求的机密性

当所请求的响应类型是`code`或`token`时，或者当重定向请求将引起在蜜柑凭据通过公开网络传输时，重定向端点应该要求使用[1.6](../Section01/1.6.md)节所述的TLS。本规范没有强制使用TLS，因为在撰写本规范时，要求客户端部署TLS对于许多客户端开发者是一严重的困难。如果TLS不可用，授权服务器应该在重定向之前警告资源所有者有关非安全端点（例如，在授权请求期间现实一条信息）。

缺乏传输层安全可能对客户端及它被授权访问的受保护资源的安全具有严重影响。当授权过程用作一种客户端委托的对最终用户认证（例如，第三方登录服务）的形式时，使用传输层安全尤其关键。

#### 3.1.2.2 注册要求

授权服务器必须要求下列客户端注册它们的重定向端点：

- 公开客户端。
- 采用隐式许可类型的机密客户端。

授权服务器应该要求所有客户端在使用授权端点前注册它们的重定向端点。

授权服务器应该要求客户端提供完整的重定向URI（客户端可以使用`state`请求参数实现每请求自定义）。如果要求完整的重定向URI注册不可行，授权服务器应该要求注册URI方案、授权和路径（当请求授权时只允许客户端动态改变重定向URI的查询部分）。

授权服务器可以允许客户端注册多个重定向端点。

缺少重定向URI注册的要求，可能使攻击者如[10.15](../Section10/10.15.md)所述将授权端点用作自由重定向端点。

#### 3.1.2.3 动态配置

如果多个重定向URI被注册，或者如果只有部分重定向URI被注册，或者如果没有重定向URI被注册，客户端都必须使用`redirect_uri`请求参数在授权请求中包含重定向URI。

当重定向URI被包含在授权请求中时，若有任何重定向URI被注册，授权服务器必须将接收到的值与至少一个已注册的重定向URI（或URI部分）按[RFC3986第6节][RFC3986#6]所述进行比较并匹配。如果客户端注册包含了完整的重定向URI，授权服务器必须使用[RFC3986第6.2.1节][RFC3986#6.2.1]中定义的简单字符串比较法比对这两个URI 。

[RFC3986#6]: http://tools.ietf.org/html/rfc3986#section-6 "Uniform Resource Identifier (URI): Generic Syntax 6节"
[RFC3986#6.2.1]: http://tools.ietf.org/html/rfc3986#section-6.2.1 "Uniform Resource Identifier (URI): Generic Syntax 6.2.1节"

#### 3.1.2.4 无效端点

如果由于缺失、无效或不匹配的重定向URI而验证失败，授权服务器应该通知资源所有者该错误且不能向无效的重定向URI自动重定向用户代理。

#### 3.1.2.5 端点内容

向客户端端点的重定向请求通常会引起由用户代理处理的HTML文档响应。如果HTML响应直接作为重定向请求的服务结果，任何包含在HTML文档中的脚本将执行，并具有对重定向URI和其包含的凭据的完全访问权限。

客户端不应该在重定向端点的响应中包含任何第三方的脚本（例如，第三方分析、社交插件、广告网络）。相反，它应该从URI中提取凭据并向另一个端点重定向用户代理而不暴露凭据（在URI中或其他地方）。如果包含第三方脚本，客户端必须确保它自己的脚本（用于从URI中提取凭据并从URI中删除）将首先执行。
